[gd_scene format=3 uid="uid://db27khuarbhe8"]

[ext_resource type="Texture2D" uid="uid://m1ndmiebo242" path="res://Assets/breakout_pixel_art/ball_default.png" id="1_dpq8s"]

[sub_resource type="CSharpScript" id="CSharpScript_dpq8s"]
script/source = "using Godot;

public partial class Ball : Actor
{
  [Export] private float ballSpeed = 25f;
  [Export] private Vector2 direction = Vector2.Left;
  [Export] private Area2D area2D;

  private Vector2[] vectorsDirections = [
    new Vector2(1,1),
    new Vector2(1,-1),
    new Vector2(-1, 1),
    new Vector2 (-1, -1)
  ];

  public Vector2 Velocity => direction * ballSpeed;

  public override void _Ready()
  {
    base._Ready();

    area2D.AreaEntered += OnAreaEntered;
    PickRandomOriginDirection();
  }

  private void OnAreaEntered(Area2D area)
  {
    if (area.GetOwner<Paddle>() is not null)
    {
      PongTheBallInPaddle();
    }
  }

  public override void _PhysicsProcess(double delta)
  {
    Move((float)delta);
  }

  private void Move(float delta)
  {
    Position += direction * (ballSpeed * delta);

    if (GameManager.Instance.IsOutOfBounds(Position, spriteWidth))
    {
      PongTheBall();
    }
  }

  private void PongTheBall()
  {
    direction.X *= -1;
  }

  private void PongTheBallInPaddle()
  {
    direction.Y *= -1;
  }

  private void PickRandomOriginDirection()
  {
    var index = (int)GD.Randi() % vectorsDirections.Length;

    direction = vectorsDirections[index];
  }

}
"

[sub_resource type="CircleShape2D" id="CircleShape2D_dpq8s"]
radius = 6.0827627

[node name="Ball" type="Node2D" unique_id=1367837317 node_paths=PackedStringArray("area2D", "sprite2D")]
script = SubResource("CSharpScript_dpq8s")
ballSpeed = 100.0
direction = null
area2D = NodePath("Area2D")
sprite2D = NodePath("Sprite2D")

[node name="Area2D" type="Area2D" parent="." unique_id=960075696]

[node name="CollisionShape2D" type="CollisionShape2D" parent="Area2D" unique_id=1671896404]
shape = SubResource("CircleShape2D_dpq8s")

[node name="Sprite2D" type="Sprite2D" parent="." unique_id=1532485448]
texture = ExtResource("1_dpq8s")
